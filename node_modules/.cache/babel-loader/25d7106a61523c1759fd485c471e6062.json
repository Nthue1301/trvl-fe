{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"E:\\\\Travel\\\\trvl-fe\\\\src\\\\features\\\\teststripe\\\\Checkoutform.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { useStripe, useElements, CardElement } from \"@stripe/react-stripe-js\";\nimport Cardinput from \"./CardInput\";\nimport stripeApi from \"../../api/stripeApi\";\nimport { message } from \"antd\";\nimport \"./card.css\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { addhoadon, hoadonData } from \"../container/admin/Hoadon/hoadonSlice\";\nimport { useHistory } from \"react-router-dom\";\nimport Axios from \"axios\";\nexport default function CheckoutForm(props) {\n  _s();\n\n  const [btn, setBtn] = useState(true);\n  const stripe = useStripe();\n  const elements = useElements();\n  const email = props.email;\n  const price = props.price * 100;\n  const hoadon = props.hoadon;\n  const tentour = props.tentour;\n  console.log(tentour);\n  const thanhtien = props.thanhtien;\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const actionhoadon = async () => {\n    await dispatch(hoadonData());\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    console.log({\n      email,\n      price: Math.floor(price)\n    });\n    setBtn(false);\n    var res = await stripeApi.poststripe({\n      email,\n      price: Math.floor(price)\n    }).then(ok => {\n      return ok.client_secret;\n    });\n    var clientSecret = res;\n    const result = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n        billing_details: {\n          email: email\n        }\n      }\n    });\n\n    if (result.error) {\n      message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\n    } else {\n      if (result.paymentIntent.status === \"succeeded\") {\n        console.log(\"thanh cong\");\n        Axios.post(\"http://localhost:666/sendemail/\", {\n          thanhtien: thanhtien,\n          email: email,\n          tentour: tentour\n        });\n        message.success(\"Thanh toán thành công!\");\n        dispatch(addhoadon({\n          tourId: hoadon.tourId,\n          userId: hoadon.userId,\n          embe: hoadon.embe,\n          treem: hoadon.treem,\n          nguoilon: hoadon.nguoilon,\n          ngaydi: hoadon.ngaydi,\n          thanhtien: thanhtien\n        }));\n        actionhoadon();\n        history.push(`/tour/${hoadon.tourId}`);\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(Cardinput, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), btn ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment\",\n      disabled: !stripe,\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment ac\",\n      disabled: false,\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n\n_s(CheckoutForm, \"M2De1eN/disvVooK8Wuyh1UdwMI=\", false, function () {\n  return [useStripe, useElements, useDispatch, useHistory];\n});\n\n_c = CheckoutForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutForm\");","map":{"version":3,"sources":["E:/Travel/trvl-fe/src/features/teststripe/Checkoutform.js"],"names":["React","useState","useStripe","useElements","CardElement","Cardinput","stripeApi","message","useDispatch","useSelector","addhoadon","hoadonData","useHistory","Axios","CheckoutForm","props","btn","setBtn","stripe","elements","email","price","hoadon","tentour","console","log","thanhtien","dispatch","history","actionhoadon","handleSubmit","event","preventDefault","Math","floor","res","poststripe","then","ok","client_secret","clientSecret","result","confirmCardPayment","payment_method","card","getElement","billing_details","error","warning","paymentIntent","status","post","success","tourId","userId","embe","treem","nguoilon","ngaydi","push"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { useStripe, useElements, CardElement } from \"@stripe/react-stripe-js\";\r\nimport Cardinput from \"./CardInput\";\r\nimport stripeApi from \"../../api/stripeApi\";\r\nimport { message } from \"antd\";\r\nimport \"./card.css\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { addhoadon, hoadonData } from \"../container/admin/Hoadon/hoadonSlice\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport Axios from \"axios\";\r\nexport default function CheckoutForm(props) {\r\n  const [btn, setBtn] = useState(true);\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const email = props.email;\r\n  const price = props.price * 100;\r\n  const hoadon = props.hoadon;\r\n  const tentour = props.tentour;\r\n  console.log(tentour);\r\n  const thanhtien = props.thanhtien;\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n  const actionhoadon = async () => {\r\n    await dispatch(hoadonData());\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (!stripe || !elements) {\r\n      return;\r\n    }\r\n    console.log({ email, price: Math.floor(price) });\r\n    setBtn(false);\r\n    var res = await stripeApi\r\n      .poststripe({ email, price: Math.floor(price) })\r\n      .then((ok) => {\r\n        return ok.client_secret;\r\n      });\r\n    var clientSecret = res;\r\n    const result = await stripe.confirmCardPayment(clientSecret, {\r\n      payment_method: {\r\n        card: elements.getElement(CardElement),\r\n        billing_details: {\r\n          email: email,\r\n        },\r\n      },\r\n    });\r\n    if (result.error) {\r\n      message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\r\n    } else {\r\n      if (result.paymentIntent.status === \"succeeded\") {\r\n        console.log(\"thanh cong\");\r\n        Axios.post(\"http://localhost:666/sendemail/\", {\r\n          thanhtien: thanhtien,\r\n          email: email,\r\n          tentour: tentour,\r\n        });\r\n        message.success(\"Thanh toán thành công!\");\r\n        dispatch(\r\n          addhoadon({\r\n            tourId: hoadon.tourId,\r\n            userId: hoadon.userId,\r\n            embe: hoadon.embe,\r\n            treem: hoadon.treem,\r\n            nguoilon: hoadon.nguoilon,\r\n            ngaydi: hoadon.ngaydi,\r\n            thanhtien: thanhtien,\r\n          })\r\n        );\r\n        actionhoadon();\r\n        history.push(`/tour/${hoadon.tourId}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <Cardinput />\r\n      {btn ? (\r\n        <button className=\"btn-payment\" disabled={!stripe}>\r\n          Thanh toán\r\n        </button>\r\n      ) : (\r\n        <button className=\"btn-payment ac\" disabled={false}>\r\n          Thanh toán\r\n        </button>\r\n      )}\r\n    </form>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}